# Omok_Server (μ¨λΌμΈ μ¤λ© κ²μ„ μ„λ²„)

## π“– ν”„λ΅μ νΈ μ†κ°

ASP.NET Core Web APIμ™€ SignalRμ„ μ‚¬μ©ν•μ—¬ κ°λ°ν• μ¨λΌμΈ μ¤λ© κ²μ„ μ„λ²„μ…λ‹λ‹¤. RESTful APIλ¥Ό ν†µν•΄ μ‚¬μ©μ μΈμ¦ λ° λ°μ΄ν„° κ΄€λ¦¬λ¥Ό μ²λ¦¬ν•κ³ , SignalRμ„ ν†µν•΄ μ‹¤μ‹κ°„ λ©€ν‹°ν”λ μ΄μ–΄ κ²μ„ λ΅μ§μ„ κµ¬ν„ν–μµλ‹λ‹¤.

## β¨ μ£Όμ” κΈ°λ¥

-   **μ‚¬μ©μ μ‹μ¤ν… (User System)**
    -   νμ›κ°€μ… (BCryptλ¥Ό μ΄μ©ν• λΉ„λ°€λ²νΈ ν•΄μ‹±)
    -   λ΅κ·ΈμΈ (JWT λ°κΈ‰)

-   **μΈμ¦ λ° μΈκ°€ (Authentication & Authorization)**
    -   JWT Bearer ν† ν°μ„ μ΄μ©ν• API μ”μ²­ μΈμ¦
    -   `[Authorize]` μ–΄νΈλ¦¬λ·°νΈ λ° μ •μ±… κΈ°λ° λ΅μ§μ„ ν†µν• μ—”λ“ν¬μΈνΈ/λ¦¬μ†μ¤ μ ‘κ·Ό μ μ–΄

-   **μ‹¤μ‹κ°„ λ§¤μΉλ©”μ΄ν‚Ή λ° κ²μ„ν”λ μ΄ (Real-time Matchmaking & Gameplay)**
    -   μΈλ©”λ¨λ¦¬ ν(`ConcurrentQueue`)μ™€ `lock`μ„ μ΄μ©ν• κ³µμ •ν•κ³  μ•μ „ν• λ§¤μΉλ©”μ΄ν‚Ή μ‹μ¤ν…
    -   SignalR Hubλ¥Ό ν†µν• μ‹¤μ‹κ°„ μ–‘λ°©ν–¥ ν†µμ‹  μ¤‘κ³„
    -   `GameRoom` μƒμ„±, μ΅°ν, μ κ±° λ“± κ²μ„ λΌμ΄ν”„μ‚¬μ΄ν΄ κ΄€λ¦¬
    -   κ²μ„ λ‚΄ ν•µμ‹¬ λ΅μ§ μ²λ¦¬ (μ λ‘κΈ°, ν„΄ μ „ν™, μΉν¨ νμ • ν›„ κ²°κ³Ό μλ™ μ €μ¥)

-   **κ²μ„ λ°μ΄ν„° κ΄€λ¦¬ (Game Data Management)**
    -   κ²½κΈ° κ²°κ³Ό μ €μ¥ (`Matches` ν…μ΄λΈ”)
    -   μ‚¬μ©μλ³„ μ „μ  μ΅°ν

-   **μ•„ν‚¤ν…μ² (Architecture)**
    -   DTO, Repository, Service ν¨ν„΄μ„ μ μ©ν• κ³„μΈµν• μ•„ν‚¤ν…μ²
    -   DI(μμ΅΄μ„± μ£Όμ…)λ¥Ό ν†µν• μ μ—°ν•κ³  ν…μ¤νΈ μ©μ΄ν• μ½”λ“ κµ¬μ΅°
    -   μ „μ—­ μμ™Έ μ²λ¦¬ λ―Έλ“¤μ›¨μ–΄λ¥Ό ν†µν• μ•μ •μ μΈ μ—λ¬ ν•Έλ“¤λ§

## π› οΈ μ‚¬μ© κΈ°μ  (Tech Stack)

-   **Backend:** ASP.NET Core 8
-   **Database:** MySQL
-   **Data Access:** SqlKata (Query Builder)
-   **Real-time Communication:** SignalR
-   **Authentication:** JWT (JSON Web Token)
-   **Security:** BCrypt.Net-Next (Password Hashing)
-   **Logging:** ZLogger

## π”„ μ „μ²΄ νλ¦„

```mermaid
graph TD
    A["μ‹μ‘ (Start)"] --> B["ν΄λΌμ΄μ–ΈνΈ: λ΅κ·ΈμΈ/νμ›κ°€μ… UI"];
    B --> C["ν΄λΌμ΄μ–ΈνΈ: ID/PW μ…λ ¥ ν›„ λ΅κ·ΈμΈ μ”μ²­"];
    C -- "HTTP POST /api/users/login" --> D["μ„λ²„: μ‚¬μ©μ μΈμ¦ μ²λ¦¬"];
    D --> E{"λ΅κ·ΈμΈ μ„±κ³µ?"};
    E -- "Yes" --> F["ν΄λΌμ΄μ–ΈνΈ: λ΅λΉ„ μ§„μ…, ν† ν° μ €μ¥,<br/>SignalR μ—°κ²° λ° λ“±λ΅"];
    E -- "No" --> B;
    
    F --> G["ν΄λΌμ΄μ–ΈνΈ: 'κ²μ„ μ°ΎκΈ°' λ²„νΌ ν΄λ¦­"];
    G -- "HTTP POST /api/matchmaking/queue" --> H["μ„λ²„: MatchmakingService λ€κΈ°μ—΄μ— μ¶”κ°€"];
    H --> I["ν΄λΌμ΄μ–ΈνΈ: 'λ§¤μΉ­ λ€κΈ° μ¤‘...' UI ν‘μ‹"];
    I -.-> J["μ„λ²„: λ§¤μΉ­ μ„±κ³µ λ°<br/>'MatchFound' μ•λ¦Ό μ „μ†΅"];
    J -- "SignalR μμ‹ " --> K["ν΄λΌμ΄μ–ΈνΈ: κ²μ„ μ”¬μΌλ΅ μ „ν™"];
    
    K --> L["ν΄λΌμ΄μ–ΈνΈ: μ¤λ©λ λ†“κΈ°"];
    L -- "SignalR 'PlaceStone'" --> M["μ„λ²„: GameHubμ—μ„ μμ‹  λ°<br/>κ²μ„ μƒνƒ μ—…λ°μ΄νΈ"];
    M --> N["μ„λ²„: μ–‘μ½ ν΄λΌμ΄μ–ΈνΈμ—<br/>'StonePlaced' μ „ν"];
    N -- "SignalR μμ‹ " --> K;
    M --> O{"κ²μ„ μΆ…λ£?"};
    O -- "No" --> K;
    O -- "Yes" --> P["μ„λ²„: DBμ— κ²°κ³Ό μ €μ¥ λ°<br/>'GameOver' μ•λ¦Ό μ „ν"];
    P -- "SignalR μμ‹ " --> Q["ν΄λΌμ΄μ–ΈνΈ: κ²°κ³Ό ν™”λ©΄ ν‘μ‹"];
    Q --> F;
```

## π€ μ•μΌλ΅μ κ³„ν (TODO)

-   [ ] Refresh Tokenμ„ μ΄μ©ν• JWT μΈμ¦ μ‹μ¤ν… κ³ λ„ν™”
-   [ ] Unity ν΄λΌμ΄μ–ΈνΈ κµ¬ν„ (API λ° SignalR μ—°λ™, κ²μ„ UI/UX)